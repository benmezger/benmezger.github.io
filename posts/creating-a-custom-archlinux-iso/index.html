<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Here I am again, trying to make my life easier for the future with my dotfiles and system environment. Yesterday I reinstalled my Archlinux, ran my Ansible against my user and all worked perfectly fine, but I still had to do some basic Linux installation beforehand, like setting my hostname, creating my user, etc.
I’ve been looking into archiso for some time now, and after reinstalling Archlinux, I started digging into it."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Creating a custom Archlinux ISO"><meta property="og:description" content="Here I am again, trying to make my life easier for the future with my dotfiles and system environment. Yesterday I reinstalled my Archlinux, ran my Ansible against my user and all worked perfectly fine, but I still had to do some basic Linux installation beforehand, like setting my hostname, creating my user, etc.
I’ve been looking into archiso for some time now, and after reinstalling Archlinux, I started digging into it."><meta property="og:type" content="article"><meta property="og:url" content="https://seds.nl/posts/creating-a-custom-archlinux-iso/"><meta property="article:published_time" content="2020-08-28T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-28T12:02:01-03:00"><title>Creating a custom Archlinux ISO | Ben Mezger</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.d06c2941d6bb925f35bc6e968bc1590f01804052cae4ad5e9ad70d2906fac7a2.css integrity="sha256-0GwpQda7kl81vG6Wi8FZDwGAQFLK5K1emtcNKQb6x6I="><script defer src=/en.search.min.cb1f873327098b7aa6344dd0648b7973fddd8e3b367e33ad3fd9a24985e7f887.js integrity="sha256-yx+HMycJi3qmNE3QZIt5c/3djjs2fjOtP9miSYXn+Ic="></script><script defer src=/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js integrity="sha256-dKi7B/C+6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-138318350-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link type=text/css rel=stylesheet href=/assets/css/orgmode.css><link type=text/css rel=stylesheet href=/assets/css/custom.css></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>Ben Mezger</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/books/>Books</a></li></ul><ul><li><a href=/posts>Blog</a></li><li><a href=/notes>Notes</a></li><li><strong>Social</strong><ul><li><a href=https://github.com/benmezger/>Github</a></li><li><a href=https://linkedin.com/in/benmezger>Linkedin</a></li><li><a href=https://twitter.com/sys%5Freboot>Twitter</a></li><li><a href=/index.xml>RSS</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Creating a custom Archlinux ISO</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=/posts/creating-a-custom-archlinux-iso/>Creating a custom Archlinux ISO</a></h1><h5>August 28, 2020</h5><div><a href=/categories/blog/>blog</a></div><div><a href=/tags/dotfiles/>dotfiles</a>,
<a href=/tags/config/>config</a>,
<a href=/tags/archlinux/>archlinux</a></div><p><p>Here I am again, trying to make my life easier for the future with my <a href=https://github.com/benmezger/dotfiles.git>dotfiles</a>
and system environment. Yesterday I reinstalled my Archlinux, ran my Ansible
against my user and all worked perfectly fine, but I still had to do some basic
Linux installation beforehand, like setting my <code>hostname</code>, creating my user,
etc.</p><p>I’ve been looking into <a href=https://wiki.archlinux.org/index.php/archiso>archiso</a> for some time now, and after reinstalling
Archlinux, I started digging into it.
<code>archiso</code> has two main profiles you can choose from, <em>releng</em> for the official
monthly ISO install or <em>baseline</em> for a minimalistic configuration, which
includes the bare minimum packages required to boot the live environment. I
choose the <em>releng</em> profile as a starting point.</p><p>You will work on the <code>airootfs/etc</code> directory, where <code>airootfs/</code> basically holds
you future <code>/</code> (root) directory.</p><p>I began updating <code>packages.x86_64</code> with the packages I needed to boot and use my
system, manually created my user by modifying <code>/etc/passwd</code>, <code>/etc/group</code>,
<code>/etc/gshadow</code> and <code>/etc/shadow</code>. Ideally you would want to take a look at your
current system configuration files and basically copy these to <code>airootfs/etc</code>
accordingly.</p><p><code>archiso</code> contains a customization bash script which gets ran after the initial
creation for the <code>ISO</code>, this is located at
<code>airootfs/root/customize_airootfs.sh</code>. I created a <code>/airootfs/home/seds</code>
directory for my user home directory, so when <code>customize_airootfs.sh</code> gets run,
it <code>cd's</code> to my home directory and initializes my dotfiles with <a href=https://chezmoi.io>Chezmoi</a>.</p><p><em>For some reason, <code>customize_airootfs.sh</code> will be deprecated, so I am not sure
what the alternative will be.</em></p><p>Now, creating the <code>ISO</code> image out of our base directory is easy, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo mkarchiso -v -w archiso-out -o out &lt;base-directory&gt;
</code></pre></div><p>This will download and install the packages specified in <code>airootfs</code>, create the
kernel and the init images and apply any customizations, it will then create the
<code>ISO</code> in the <code>out/</code> directory and keep any cached files in <code>archiso-out</code>.</p><p>Finally, you can test out the image with Qemu.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>run_archiso -i ./out/archlinux-yyyy.mm.dd-x86_64.iso
</code></pre></div><p>If everything looks good, burn the <code>ISO</code> to your USB stick and boot it up. Don’t
forget you still have to handle your partitions, and make any install
modifications required by Archlinux (those you cannot really automate, or can you!?).</p><p>That’s all for today, folks.</p><style>.org-center{margin-left:auto;margin-right:auto;text-align:center}</style><div class=org-center><div></div><div class=github-card data-github=benmezger/archiso data-width=400 data-height=150 data-theme=default></div><script src=//cdn.jsdelivr.net/github-cards/latest/widget.js></script></div><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://wiki.archlinux.org/index.php/archiso>Archiso - Archlinux Wiki</a></li><li><a href=https://gitlab.archlinux.org/archlinux/archiso/-/blob/master/docs/README.build>Archiso - Gitlab</a></li></ul></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/benmezger/blog/commit/3ee6a5ef4832e67bef4aea49a8d842e6cc395855 title="Last modified by Ben Mezger | August 28, 2020" target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>August 28, 2020</span></a></div><div><a class="flex align-center" href=https://github.com/benmezger/blog/edit/main/content/posts/creating-a-custom-archlinux-iso.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><div class=book-comments><script src=https://utteranc.es/client.js repo=benmezger/blog label=comment issue-term=pathname theme=github-dark crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><ul><li><a href=#references>References</a></li></ul></li></ul></nav></aside></main></body></html>